<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="canonical" href="https://www.serpmonn.ru"/>
    <meta name="description" content="Испытайте свои рефлексы в игре, где нужно уворачиваться от падающих фигур! Сможете ли вы продержаться как можно дольше и избежать столкновений? Проверьте свои навыки и реакцию в этой динамичной игре!">
    <link rel="icon" href="../../images/Serpmonn.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Падающие синие квадраты</title>
    <style>

        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            flex-direction: column;
        }

        #score {
            position: absolute;
            top: 50px;
            left: 10px;
            font-size: 24px;
            font-family: Arial, sans-serif;
        }

	#missed {
            position: absolute;
            top: 80px;
            left: 10px;
            font-size: 24px;
            font-family: Arial, sans-serif;
        }

	#leaderboardBtn {
	    position: absolute;
	    top: 10px;
	    left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

	#homeBtn {
	    position: absolute;
	    top: 10px;
	    right: 20%;
	    transform: translateX(50%);
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    background-color: red;
	    color: white;
	    border: none;
	    border-radius: 5px;
	}

	#pauseBtn {
	    position: absolute;
	    top: 10px;
	    left: 20%;
	    transform: translateX(-50%);
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    background-color: orange;
	    color: white;
	    border: none;
	    border-radius: 5px;
	}	
        
        #nicknameForm {
            position: absolute;
            top: 50px;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        #nicknameForm input {
            margin-bottom: 10px;
            padding: 5px;
            font-size: 16px;
        }
        
	#nicknameForm button {
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    background-color: red;
	    color: white;
	    border: none;
	    border-radius: 5px;
	}

	@media (max-width: 600px) {

	.button-container {
	    display: flex;
	    flex-direction: row;
	    justify-content: center;
	    position: static;
	    top: 0;
	    width: 100%;
	}


	#leaderboardBtn, #homeBtn, #pauseBtn {
	    width: 27%; /* Устанавливает ширину кнопок */
	    display: flex; /* Использует Flexbox для кнопок */
	    align-items: center; /* Выравнивает элементы по центру вертикально */
	    justify-content: center; /* Выравнивает элементы по центру горизонтально */
	}

	#nicknameForm {
	    top: auto;
	    bottom: 10px;
	    right: 50%;
	    transform: translateX(50%);
	    display: flex;
            flex-direction: column;
            align-items: center;
	}

	}
    </style>
</head>
<body>
    <div id="score">Очки: 0</div>
    <div id="missed">Пропуски: 0</div>
    <div class="button-container">
        <button id="leaderboardBtn">Таблица лидеров</button>
        <button id="homeBtn">Домой</button>
        <button id="pauseBtn">Пауза</button>
    </div>
    <form id="nicknameForm">
        <input type="text" id="nickname" placeholder="Введи своё Имя" required>
        <button type="submit">Начать игру</button>
    </form>
    <canvas id="gameCanvas"></canvas>

	    <script>

	    const canvas = document.getElementById('gameCanvas');
	    const ctx = canvas.getContext('2d');
	    canvas.width = window.innerWidth;
	    canvas.height = window.innerHeight;

	    const player = {
	        x: canvas.width / 2 - 25,
	        y: canvas.height - 50,
	        width: 50,
	        height: 50,
	        color: 'red',
	        speed: 7,
	        dx: 0,
	        nickname: ''
	    };

	    const objects = [];
	    const objectSize = 20;
	    let objectSpeed = 2;
	    let score = 0;
	    let level = 1;
	    let missedObjects = 0;
	    let isPaused = false;
	    let friction = 0.9;
	    let lastTime = 0;

	    function drawPlayer() {
	        ctx.fillStyle = player.color;
	        ctx.fillRect(player.x, player.y, player.width, player.height);
	    }

	    function createObject() {
                const size = 20 + Math.random() * 40; // Случайный размер от 10 до 40 пикселей
                const x = Math.random() * (canvas.width - size);
                const shape = Math.random() < 0.5 ? 'square' : 'circle'; // Случайная форма: квадрат или круг
                objects.push({ x, y: 0, size, shape, color: 'blue' });
            }

	    function drawObjects() {
		    objects.forEach(obj => {
		        ctx.fillStyle = obj.color;
		        if (obj.shape === 'square') {
		            ctx.fillRect(obj.x, obj.y, obj.size, obj.size);
		        } else if (obj.shape === 'circle') {
		            ctx.beginPath();
		            ctx.arc(obj.x + obj.size / 2, obj.y + obj.size / 2, obj.size / 2, 0, Math.PI * 2);
		            ctx.fill();
		        }
		    });
	    }

	    function updateObjects(deltaTime) {
		    objects.forEach(obj => {
		        obj.y += objectSpeed * (deltaTime / 16); // Используем deltaTime для обновления позиции
		        if (obj.y + objectSize > canvas.height) {
		            objects.splice(objects.indexOf(obj), 1);
		            missedObjects++;
		            document.getElementById('missed').innerText = `Пропуски: ${missedObjects}`;
		            if (missedObjects >= 100) {
		                endGame();
		            }
		        }
		        if (obj.x < player.x + player.width &&
		            obj.x + objectSize > player.x &&
		            obj.y < player.y + player.height &&
		            obj.y + objectSize > player.y) {
		            objects.splice(objects.indexOf(obj), 1);
		            score++;
		            document.getElementById('score').innerText = `Очки: ${score}`;
		            if (score % 10 === 0) {
		                level++;
		                objectSpeed += 1;
		            }
		        }
		    });
	    }

	    function clear() {
	        ctx.clearRect(0, 0, canvas.width, canvas.height);
	    }

	    function update(timestamp) {
		    if (!lastTime) lastTime = timestamp;
		    const deltaTime = timestamp - lastTime;
		    lastTime = timestamp;

		    if (!isPaused) {
		        clear();
		        drawPlayer();
		        drawObjects();
		        updateObjects(deltaTime);
		        movePlayer(deltaTime);
		    }
		    requestAnimationFrame(update);
		}

	    function movePlayer(deltaTime) {
		    player.dx *= friction;
		    player.x += player.dx * (deltaTime / 16); // Используем deltaTime для обновления позиции
		    if (player.x < 0) player.x = 0;
		    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
		}

	    function keyDown(e) {
	        if (e.key === 'ArrowRight' || e.key === 'Right') {
	            player.dx = player.speed;
	        } else if (e.key === 'ArrowLeft' || e.key === 'Left') {
	            player.dx = -player.speed;
	        }
	    }

	    function keyUp(e) {
	        if (e.key === 'ArrowRight' || e.key === 'Right' || e.key === 'ArrowLeft' || e.key === 'Left') {
	            player.dx = 0;
	        }
	    }

	    document.addEventListener('keydown', keyDown);
	    document.addEventListener('keyup', keyUp);

	    // Touch controls
	    canvas.addEventListener('touchstart', handleTouchStart);
	    canvas.addEventListener('touchmove', handleTouchMove);

	    let touchX = null;

	    function handleTouchStart(e) {
	        touchX = e.touches[0].clientX;
	    }

	    function handleTouchMove(e) {
	        if (touchX !== null) {
	            const newTouchX = e.touches[0].clientX;
	            const dx = newTouchX - touchX;
	            player.x += dx;
	            touchX = newTouchX;
	        }
	    }

	    canvas.addEventListener('touchend', () => {
	        touchX = null;
	    });

	    function updateLeaderboard() {
	        fetch('https://www.serpmonn.ru/leaderboard')
	            .then(response => response.json())
	            .then(data => {
	                const leaderboardDiv = document.getElementById('leaderboard');
	                leaderboardDiv.innerHTML = 'Leaderboard:<br>' + data.map((entry, i) => `${i + 1}. ${entry.nickname}: ${entry.score}`).join('<br>');
	            });
	    }

	    function endGame() {
	        fetch('https://www.serpmonn.ru/add-score', {
	            method: 'POST',
	            headers: {
	                'Content-Type': 'application/json'
	            },
	            body: JSON.stringify({ nickname: player.nickname, score })
	        }).then(() => {
		    updateLeaderboard();
	            window.location.href = 'score_table.html';
	        });
	    }

	    fetch('https://www.serpmonn.ru/proxy/bannedWords')
	    .then(response => response.json())
	    .then(data => {
	        // Функция для проверки никнейма на наличие запрещенных слов
	        function containsBannedWords(nickname) {
	            for (let item of data) {
	                if (nickname.toLowerCase().includes(item.word)) {
	                    return true;
	                }
	            }
	            return false;
	        }

	        // Обработчик отправки формы никнейма
	        document.getElementById('nicknameForm').addEventListener('submit', function(e) {
	            e.preventDefault();
	            const nickname = document.getElementById('nickname').value;
	            if (containsBannedWords(nickname)) {
	                alert('Никнейм содержит запрещенные слова. Пожалуйста, выберите другой никнейм.');
	            } else {
	                player.nickname = nickname;
	                document.getElementById('nicknameForm').style.display = 'none';
	                setInterval(createObject, 1000);
	                requestAnimationFrame(update); // Запуск функции обновления
	            }
	        });
	    });

	    document.getElementById('leaderboardBtn').addEventListener('click', function() {
	        window.open('score_table.html', '_blank');
	    });

	    document.getElementById('homeBtn').addEventListener('click', function() {
		window.location.href = 'https://www.serpmonn.ru';
	    });

	    document.getElementById('pauseBtn').addEventListener('click', function() {
		isPaused = !isPaused;
		document.getElementById('pauseBtn').innerText = isPaused ? 'Продолжить' : 'Пауза';
	    });

	    window.addEventListener('pageshow', () => {
		  requestAnimationFrame(() => {
		    document.body.style.paddingBottom = 'env(safe-area-inset-bottom)';
		    // Принудительное обновление макета
		    document.body.offsetHeight; // Триггер обновления макета
		  });
		});

	</script>
</body>
</html>

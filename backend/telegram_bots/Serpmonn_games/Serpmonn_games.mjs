import dotenv from 'dotenv';                                                                                                     // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º dotenv –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
import { resolve } from 'path';                                                                                                  // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º resolve –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
import TelegramBot from 'node-telegram-bot-api';                                                                                 // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º TelegramBot –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–∞

const isProduction = process.env.NODE_ENV === 'production';                                                                      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: production –∏–ª–∏ development
const envPath = isProduction                                                                                                     // –í—ã–±–∏—Ä–∞–µ–º –ø—É—Ç—å –∫ .env —Ñ–∞–π–ª—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
    ? '/var/www/serpmonn.ru/backend/telegram_bots/.env'                                                                                                // –ü—Ä–æ–¥–∞–∫—à–µ–Ω –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    : resolve(process.cwd(), 'backend/telegram_bots/.env');                                                                                    // –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ .env –≤ –ø–∞–ø–∫–µ backend

dotenv.config({ path: envPath });                                                                                                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏

const SERPMONN_GAMES_TOKEN = process.env.SERPMONN_GAMES_TOKEN;                                                                   // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º SERPMONN_GAMES_TOKEN
const bot = new TelegramBot(SERPMONN_GAMES_TOKEN, { polling: true });                                                            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ SERPMONN_GAMES_TOKEN

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL –∏–≥—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
function getGameUrl(gamePath) {
    const baseUrl = isProduction                                                                                                 // –í—ã–±–∏—Ä–∞–µ–º –±–∞–∑–æ–≤—ã–π URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
        ? 'https://serpmonn.ru'                                                                                                  // –ü—Ä–æ–¥–∞–∫—à–µ–Ω URL
        : 'http://localhost:5173';                                                                                               // –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - –ª–æ–∫–∞–ª—å–Ω—ã–π URL Vite —Å–µ—Ä–≤–µ—Ä–∞
    
    return `${baseUrl}${gamePath}`;                                                                                              // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL –¥–ª—è –∏–≥—Ä—ã
}

bot.on('polling_error', (error) => {                                                                                             // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ polling –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error.message);                                                                         // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API
});

bot.onText(/\/start/, (msg) => {                                                                                                 // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–µ–Ω—é –∏–≥—Ä
    const chatId = msg.chat.id;                                                                                                  // –ü–æ–ª—É—á–∞–µ–º ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞

    const keyboard = {                                                                                                           // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–≥—Ä
        inline_keyboard: [                                                                                                       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ä—è–¥–∞–º–∏ –∫–Ω–æ–ø–æ–∫
            [                                                                                                                    // –ü–µ—Ä–≤—ã–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
                {                                                                                                                // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∏–≥—Ä—ã 2048
                    text: "–ò–≥—Ä–∞—Ç—å –≤ 2048",                                                                                       // –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    web_app: { url: getGameUrl("/games/2048/index.html") }                                                       // –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
                }
            ],
            [                                                                                                                    // –í—Ç–æ—Ä–æ–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
                {                                                                                                                // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∏–≥—Ä—ã –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –±–µ–≥—Å—Ç–≤–æ
                    text: "–ò–≥—Ä–∞—Ç—å –≤ –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –±–µ–≥—Å—Ç–≤–æ",                                                                         // –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    web_app: { url: getGameUrl("/games/redsquare/redsquare.html") }                                              // –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
                }
            ],
            [                                                                                                                    // –¢—Ä–µ—Ç–∏–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
                {                                                                                                                // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∏–≥—Ä—ã –ü–∞–¥–∞—é—â–∏–µ —Ñ–∏–≥—É—Ä—ã
                    text: "–ò–≥—Ä–∞—Ç—å –≤ –ü–∞–¥–∞—é—â–∏–µ —Ñ–∏–≥—É—Ä—ã",                                                                            // –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    web_app: { url: getGameUrl("/games/redsquare2/redsquare2.html") }                                            // –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
                }
            ]
        ]
    };

    bot.sendMessage(chatId, "üéÆ –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:", {                                                                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ–Ω—é –∏–≥—Ä
        reply_markup: keyboard                                                                                                   // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
    }).catch(error => {                                                                                                          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);                                                                      // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    });
});

bot.onText(/\/help/, (msg) => {                                                                                                  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–ø—Ä–∞–≤–∫–∏
    const chatId = msg.chat.id;                                                                                                  // –ü–æ–ª—É—á–∞–µ–º ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
    
    const helpText = `                                                                                                           // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–ø—Ä–∞–≤–∫–∏ —Å HTML —Ä–∞–∑–º–µ—Ç–∫–æ–π
ü§ñ <b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É</b>

‚ñ´Ô∏è <b>/start</b> - –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –∏–≥—Ä
‚ñ´Ô∏è <b>/help</b> - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

–ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ –º–µ–Ω—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å –ø—Ä—è–º–æ –≤ Telegram!
    `;

    bot.sendMessage(chatId, helpText, {                                                                                          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø—Ä–∞–≤–∫–æ–π
        parse_mode: 'HTML'                                                                                                       // –£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ HTML —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
    }).catch(error => {                                                                                                          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ help-—Å–æ–æ–±—â–µ–Ω–∏—è:", error);                                                                 // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ help-—Å–æ–æ–±—â–µ–Ω–∏—è
    });
});

console.log("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –æ–∂–∏–¥–∞–µ—Ç –∫–æ–º–∞–Ω–¥...");                                                                                  // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
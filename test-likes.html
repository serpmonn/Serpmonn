<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ª–∞–π–∫–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ª–∞–π–∫–æ–≤</h1>
    
    <div class="test-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ cookies</h3>
        <button onclick="checkCookies()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookies</button>
        <div id="cookies-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç –≥–æ—Å—Ç–µ–≤–æ–≥–æ –ª–∞–π–∫–∞</h3>
        <button onclick="testGuestLike()">–ü–æ—Å—Ç–∞–≤–∏—Ç—å –≥–æ—Å—Ç–µ–≤–æ–π –ª–∞–π–∫</button>
        <div id="guest-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–∞–π–∫–∞</h3>
        <button onclick="testAuthLike()">–ü–æ—Å—Ç–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ª–∞–π–∫</button>
        <div id="auth-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ª–∞–π–∫–æ–≤</h3>
        <button onclick="checkLikes()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <div id="status-result" class="result"></div>
    </div>

    <script>
        const TEST_URL = 'https://example.com/test-browser';
        
        function checkCookies() {
            const cookies = document.cookie;
            const result = document.getElementById('cookies-result');
            
            if (cookies.includes('token=')) {
                result.innerHTML = '‚úÖ –ù–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω –≤ cookies:<br>' + cookies;
            } else {
                result.innerHTML = '‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ cookies:<br>' + (cookies || '–ù–µ—Ç cookies');
            }
        }
        
        async function testGuestLike() {
            const result = document.getElementById('guest-result');
            result.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –ª–∞–π–∫–∞...';
            
            try {
                const response = await fetch('/api/likes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Accept': 'application/json'
                    },
                    body: `url=${encodeURIComponent(TEST_URL)}`,
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                result.innerHTML = `‚úÖ –ì–æ—Å—Ç–µ–≤–æ–π –ª–∞–π–∫: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function testAuthLike() {
            const result = document.getElementById('auth-result');
            result.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–∞–π–∫–∞...';
            
            try {
                const response = await fetch('/api/likes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Accept': 'application/json'
                    },
                    body: `url=${encodeURIComponent(TEST_URL + '-auth')}`,
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                result.innerHTML = `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ª–∞–π–∫: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function checkLikes() {
            const result = document.getElementById('status-result');
            result.innerHTML = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...';
            
            try {
                const response = await fetch(`/api/likes?url=${encodeURIComponent(TEST_URL)}`);
                const data = await response.json();
                result.innerHTML = `‚úÖ –°—Ç–∞—Ç—É—Å: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å cookies –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkCookies;
    </script>
</body>
</html>
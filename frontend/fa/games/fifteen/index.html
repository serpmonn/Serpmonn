<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
<link rel="canonical" href="https://www.serpmonn.ru/frontend/fa/games/fifteen/index.html">
<meta property="og:url" content="https://www.serpmonn.ru/frontend/fa/games/fifteen/index.html" />
<link rel="stylesheet" href="/frontend/styles/styles.css">
<meta http-equiv="Content-Language" content="fa">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Пятнашки — Serpmonn</title>
    <meta name="description" content="Пятнашки (15 Puzzle): собери плитки 1–15 по порядку, пустая ячейка — для перемещения.">
    <link rel="icon" href="/frontend/images/serpmonn.ico" type="image/x-icon">
    <link rel="stylesheet" href="/frontend/styles/base.css">
    <link rel="stylesheet" href="/frontend/styles/accessibility.css">
    <link rel="stylesheet" href="/frontend/styles/menu.css">
    <script async src="https://ad.mail.ru/static/ads-async.js"></script>
    <style>
      :root { --bg:#0e0f12; --panel:#121720; --text:#e8e8e8; --tile:#1a2230; --tile2:#182a3b; --accent:#dc3545; }
      html, body { width:100%; height:100%; background: var(--bg); overflow:hidden; }
      body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--text); }
      .page { max-width: 1000px; margin: 0 auto; padding: 16px; }
      header { display:flex; align-items:center; gap:12px; margin: 10px 0 16px; }
      header h1 { font-size: 1.6rem; margin: 0; }
      .wrap { display:grid; grid-template-columns: 1fr 320px; gap: 16px; align-items:start; }
      .panel { background: var(--panel); border:1px solid #1c2431; border-radius:10px; padding:12px 14px; }
      .board { width: 360px; height: 360px; margin: 0 auto; display:grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); gap: 8px; }
      .tile { display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, #1a2230, #182a3b); border:1px solid #223042; color:#fff; font-weight:800; font-size: 28px; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,.2); user-select: none; cursor:pointer; }
      .tile.empty { background: transparent; border:1px dashed #253240; box-shadow:none; cursor: default; }
      .stats { display:grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
      .stat { background:#0f151d; border:1px solid #1b2633; border-radius:8px; padding:8px 10px; text-align:center; }
      .controls { display:flex; gap:8px; justify-content:center; margin-top:10px; }
      .btn { background:#16202a; border:1px solid #243241; color:#eee; border-radius:8px; padding:8px 10px; cursor:pointer; }
      .btn.primary { background: linear-gradient(90deg, #dc3545, #c82333); border:none; }
      .hint { color:#cfcfcf; font-size:.95rem; text-align:center; margin-top:10px; }
      @media (max-width: 960px) { .wrap{grid-template-columns:1fr;} .board{width: 320px; height:320px;} .tile{font-size:24px;} }
    </style>
  </head>
  <body>
    <div id="menuContainer"></div>
    <script>
      window.showFullScreenAd = window.showFullScreenAd || function(){
        try {
          var ov = document.getElementById('game-ad-overlay');
          if(!ov){
            ov = document.createElement('div');
            ov.id = 'game-ad-overlay';
            ov.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:9999;';
            var box = document.createElement('div');
            box.style.cssText = 'background:#111;border:1px solid #222;border-radius:12px;padding:12px;text-align:center;max-width:90vw;max-height:90vh;';
            var ins = document.createElement('ins');
            ins.className = 'mrg-tag';
            ins.setAttribute('data-ad-client','ad-1844883');
            ins.setAttribute('data-ad-slot','1844883');
            var btn = document.createElement('button');
            btn.className='btn'; btn.textContent='Продолжить'; btn.style.marginTop='10px';
            btn.onclick=function(){ ov.remove(); };
            box.appendChild(ins); box.appendChild(btn); ov.appendChild(box); document.body.appendChild(ov);
            (window.MRGtag = window.MRGtag || []).push({});
          } else {
            ov.style.display='flex'; (window.MRGtag = window.MRGtag || []).push({});
          }
        } catch(_){}
      };
    </script>
    <div class="page">
      <header>
        <img src="/frontend/images/WebGames.ico" width="28" height="28" alt="Игры" style="border-radius:6px;">
        <h1>Пятнашки</h1>
      </header>
      <script>
        (function(){
          function isMobile(){ return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) || (window.innerWidth < 768); }
          function showInstructions(){
            if (localStorage.getItem('game_instructions_fifteen_shown')==='1') return;
            var ov=document.createElement('div'); ov.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:9998;';
            var box=document.createElement('div'); box.style.cssText='max-width:90vw;background:#141821;color:#fff;border:1px solid #1f2632;border-radius:12px;padding:16px;text-align:left;';
            var h=document.createElement('h3'); h.textContent='Как играть — Пятнашки'; h.style.margin='0 0 8px';
            var p=document.createElement('div'); p.style.cssText='font-size:14px;line-height:1.5;white-space:pre-line';
            p.textContent = isMobile() ? '• Тап по плитке рядом с пустой — перемещение'
                                     : '• Клик по плитке рядом с пустой — перемещение\n• Пробел — перемешать, R — собрать';
            var btn=document.createElement('button'); btn.className='btn'; btn.textContent='Понятно'; btn.style.marginTop='10px';
            btn.onclick=function(){ ov.remove(); localStorage.setItem('game_instructions_fifteen_shown','1'); };
            box.appendChild(h); box.appendChild(p); box.appendChild(btn); ov.appendChild(box); document.body.appendChild(ov);
          }
          document.addEventListener('DOMContentLoaded', showInstructions);
        })();
      </script>
      <div class="ad-top-banner" style="text-align:center;margin:16px 0;">
        <ins class="mrg-tag" style="display:inline-block;" data-ad-client="ad-1897960" data-ad-slot="1897960"></ins>
      </div>
      <script>(window.MRGtag = window.MRGtag || []).push({});</script>

      <div class="wrap">
        <div class="panel">
          <div id="board" class="board" aria-label="Игровое поле"></div>
          <div class="hint" style="display:none;">Клик/тач по плитке рядом с пустой — перемещает её. Заново — R.</div>
        </div>
        <div class="panel">
          <div class="stats">
            <div class="stat">Ходы<br><b id="moves">0</b></div>
            <div class="stat">Время<br><b id="time">0</b>с</div>
            <div class="stat">Лучшее<br><b id="best">—</b></div>
          </div>
          <div class="controls">
            <button class="btn primary" id="btnShuffle">Перемешать</button>
            <button class="btn" id="btnReset">Собрано</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/frontend/scripts/menu-loader.js" defer></script>
    <script>
      (function(){
        const board = document.getElementById('board');
        const movesEl = document.getElementById('moves');
        const timeEl = document.getElementById('time');
        const bestEl = document.getElementById('best');
        const btnShuffle = document.getElementById('btnShuffle');
        const btnReset = document.getElementById('btnReset');
        const bestKey = 'fifteen_best_time_v1';

        const size = 4; // 4x4
        let tiles, empty, moves, startTime, timer, running;
        const bestSaved = parseInt(localStorage.getItem(bestKey)||'0',10); bestEl.textContent = bestSaved>0? String(bestSaved)+'с':'—';

        function solvedState(){
          const arr=[]; for(let i=1;i<=15;i++) arr.push(i); arr.push(0); return arr; // 0 — пустая
        }
        function clone(a){ return a.slice(); }

        function draw(){
          board.innerHTML='';
          tiles.forEach((val,idx)=>{
            const div = document.createElement('div');
            const x = idx % size, y = Math.floor(idx/size);
            div.className = 'tile' + (val===0 ? ' empty' : '');
            if(val!==0) div.textContent = String(val);
            div.addEventListener('click', ()=> tryMove(x,y));
            // улучшение тач: предотвращаем скролл и двойной тап
            div.addEventListener('touchstart', (e)=>{ e.preventDefault(); tryMove(x,y); }, {passive:false});
            board.appendChild(div);
          });
        }

        function posToIdx(x,y){ return y*size + x; }
        function neighbors(x,y){ return [[x-1,y],[x+1,y],[x,y-1],[x,y+1]].filter(([nx,ny])=> nx>=0&&ny>=0&&nx<size&&ny<size ); }

        function tryMove(x,y){
          if(!running) startTimer();
          const idx = posToIdx(x,y);
          if(tiles[idx]===0) return; // клик по пустой — игнор
          const adj = neighbors(x,y);
          for(const [nx,ny] of adj){
            const nidx = posToIdx(nx,ny);
            if(tiles[nidx]===0){
              // swap
              const t = tiles[idx]; tiles[idx]=0; tiles[nidx]=t; moves++; movesEl.textContent=String(moves);
              draw();
              checkWin();
              return;
            }
          }
        }

        function checkWin(){
          for(let i=0;i<16;i++){ if(tiles[i] !== (i===15?0:i+1)) return false; }
          stopTimer();
          const t = Math.floor((Date.now()-startTime)/1000);
          if(bestSaved===0 || t<bestSaved){ localStorage.setItem(bestKey,String(t)); bestEl.textContent=String(t)+'с'; }
          overlayMsg('Собрано!');
          return true;
        }

        function shuffle(){
          // случайные валидные ходы из решённого состояния для сохранения решаемости
          tiles = solvedState();
          empty = {x: size-1, y: size-1};
          const steps = 200; // перемешивание
          for(let i=0;i<steps;i++){
            const nbs = neighbors(empty.x, empty.y);
            const [nx,ny] = nbs[Math.floor(Math.random()*nbs.length)];
            const eidx = posToIdx(empty.x, empty.y);
            const nidx = posToIdx(nx,ny);
            tiles[eidx] = tiles[nidx];
            tiles[nidx] = 0;
            empty = {x:nx, y:ny};
          }
          moves=0; movesEl.textContent='0';
          resetTimer();
          draw();
        }

        function resetSolved(){ tiles = solvedState(); moves=0; movesEl.textContent='0'; resetTimer(); draw(); }

        function startTimer(){ if(running) return; running = true; startTime = Date.now(); timer = setInterval(()=>{ timeEl.textContent = String(Math.floor((Date.now()-startTime)/1000)); }, 1000); }
        function stopTimer(){ running = false; clearInterval(timer); }
        function resetTimer(){ stopTimer(); timeEl.textContent='0'; }

        function overlayMsg(text){
          const mask = document.createElement('div'); mask.style.cssText='position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);border-radius:10px;';
          const msg = document.createElement('div'); msg.style.cssText='background:#141821;border:1px solid #1f2632;color:#fff;padding:12px 16px;border-radius:8px;font-weight:700;'; msg.textContent=text;
          const container = board.parentElement; container.style.position='relative'; mask.appendChild(msg); container.appendChild(mask); setTimeout(()=>mask.remove(),1500);
        }

        btnShuffle.addEventListener('click', shuffle);
        btnReset.addEventListener('click', resetSolved);
        window.addEventListener('keydown', (e)=>{ const k=e.key.toLowerCase(); if(k==='r') resetSolved(); if(k===' ') shuffle(); });

        resetSolved();
        shuffle();
      })();
    </script>
      <script src="/frontend/scripts/mobile-enhancements.js" defer></script>
</body>
</html>